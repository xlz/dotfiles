#!/bin/sh
#params='root=/dev/sda2 ro quiet panic=9 video=efifb:off acpi_osi="!Windows 2012" acpi_osi="!Windows 2013" initrd=EFI/debian/initrd.img'
mount -v /boot/efi
esp=/boot/efi/EFI/debian
if [ ! -e /vmlinuz ]; then
	echo /vmlinuz not found >&2
	exit 1
fi
if [ -e /vmlinuz.old ]; then
	cp -aLv /vmlinuz $esp/vmlinuz.efi
	cp -aLv /vmlinuz.old $esp/vmlinuz-old.efi
	cp -aLv /initrd.img $esp/initrd.img
	cp -aLv /initrd.img.old $esp/initrd-old.img
else
	if ! diff -q /vmlinuz $esp/vmlinuz.efi; then
		mv -v $esp/vmlinuz.efi $esp/vmlinuz-old.efi
		cp -aLv /vmlinuz $esp/vmlinuz.efi
		mv -v $esp/initrd.img $esp/initrd-old.img
		cp -aLv /initrd.img $esp/initrd.img
	fi
fi
umount /boot/efi
